{% extends "collabrate/base.html" %}
{% load static %}

{% block title %}Create Team{% endblock %}

{% block content %}
<!-- Outer container for sidebar + main content -->
<div class="d-flex">

    {% include "course/sidenav.html" %}

    <!-- Main content -->
    <div class="flex-fill p-4">

        <!-- Course header with "Create New Group" button -->
        <div class="d-flex justify-content-between align-items-center p-3 mb-3" style="background-color: #f05a28; border-radius: 0.25rem;">
            <h2 class="text-white mb-0">{{ course.code }} | {{ course.title }}</h2>
            <!-- Button that toggles a collapsible form below -->
            <button class="btn btn-light" data-bs-toggle="collapse" data-bs-target="#createTeamForm">
                + Create New Group
            </button>
        </div>

        <!-- Collapsible form for creating new team -->
        <div class="collapse mb-4" id="createTeamForm">
            <div class="card card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="team_name" class="form-label">Team Name</label>
                        <input 
                            type="text" 
                            name="team_name" 
                            id="team_name" 
                            class="form-control" 
                            required 
                        />
                    </div>
                    <div class="mb-3">
                        <label for="students" class="form-label">Select Students</label>
                        <!-- Multiple select for students in the course -->
                        <select name="students" id="students" class="form-select" multiple>
                            {% for student in students %}
                                <option value="{{ student.id }}">{{ student.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Team</button>
                </form>
            </div>
        </div>

        <!-- Accordion listing existing teams in this course -->
        {% if course.team_set.all %}
            <div class="accordion" id="teamsAccordion">
                {% for team in course.team_set.all %}
                <div class="accordion-item mb-2">
                    <h2 class="accordion-header" id="heading{{ team.id }}">
                        <button 
                            class="accordion-button {% if not forloop.first %}collapsed{% endif %}" 
                            type="button" 
                            data-bs-toggle="collapse" 
                            data-bs-target="#collapse{{ team.id }}" 
                            aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" 
                            aria-controls="collapse{{ team.id }}"
                        >
                            {{ team.name }}
                        </button>
                    </h2>
                    <div 
                        id="collapse{{ team.id }}" 
                        class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" 
                        aria-labelledby="heading{{ team.id }}" 
                        data-bs-parent="#teamsAccordion"
                    >
                        <div class="accordion-body">
                            <p><strong>Members:</strong></p>
                            <ul>
                                {% for member in team.students.all %}
                                <li>{{ member.username }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info">
                No teams have been created yet.
            </div>
        {% endif %}

    </div><!-- End main content -->
</div><!-- End d-flex container -->
{% endblock %}
