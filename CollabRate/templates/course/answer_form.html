{% extends 'collabrate/base.html' %}
{% load static %}

{% block title %}Answer Form{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'course/course_landing.css' %}">
<link rel="stylesheet" href="{% static 'course/sidenav.css' %}">
<style>
  .top-banner {
      background-color: {{ course.color }};
      border-radius: 8px;
      height: 64px;
      display: flex;
      align-items: center;
      width: 90%;
  }
  .top-banner h1 {
      margin-left: 12px;
      font-size: 32px;
      color: black;
  }
  .question-section {
      margin-bottom: 2rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="d-flex">
    <div class="d-flex col-md-3">
        {% include "course/sidenav.html" %}
    </div>
    <div class="col-md-9" style="margin-left: 24px;">
        <div class="top-banner">
            <h1>{{ course.code }} | {{ course.title }}</h1>
        </div>
        <div class="mt-4">
            <h2>{{ form_obj.name }}</h2>
            <p>Due: {{ form_obj.due_date }} at {{ form_obj.due_time }}</p>
        </div>
        <form method="post" action="">
            {% csrf_token %}

            {# Peer selector (only if not self_evaluate) #}
            {% if not form_obj.self_evaluate %}
                <div class="mb-3">
                    <label for="evaluee_id" class="form-label"><strong>Select student to evaluate:</strong></label>
                    <select name="evaluee_id" id="evaluee_id" class="form-select" required>
                            <option value="" selected disabled>-- choose peer --</option>
                            {% for peer in potential_peers %}
                                <option value="{{ peer.id }}">{{ peer.get_full_name|default:peer.username }}</option>
                            {% endfor %}
                    </select>
                </div>
            {% endif %}

            <!-- Likert Scale -->
            <div class="question-section">
                <h3>Likert Scale Questions</h3>
                {% for likert in likert_questions %}
                    <div class="mb-3">
                        <label><strong>{{ forloop.counter }}. {{ likert.question }}</strong></label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="likert_{{ likert.id }}" value="1" required>
                                <label class="form-check-label">{{ likert.option_1 }}</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="likert_{{ likert.id }}" value="2">
                                <label class="form-check-label">{{ likert.option_2 }}</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="likert_{{ likert.id }}" value="3">
                                <label class="form-check-label">{{ likert.option_3 }}</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="likert_{{ likert.id }}" value="4">
                                <label class="form-check-label">{{ likert.option_4 }}</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="likert_{{ likert.id }}" value="5">
                                <label class="form-check-label">{{ likert.option_5 }}</label>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <p>No Likert-scale questions in this form.</p>
                {% endfor %}
            </div>

            <!-- Open-Ended  -->
            <div class="question-section">
                <h3>Open-Ended Questions</h3>
                {% for open_q in open_questions %}
                    <div class="mb-3">
                        <label><strong>{{ forloop.counter }}. {{ open_q.question }}</strong></label>
                        <textarea name="open_{{ open_q.id }}" class="form-control" rows="4" required></textarea>
                    </div>
                {% empty %}
                    <p>No open-ended questions in this form.</p>
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-primary">Submit Answers</button>
        </form>
    </div>
</div>
{% endblock %}