{% extends 'collabrate/base.html' %}
{% block title %}Peer Results{% endblock %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'dashboard/peer_results.css' %}">
{% endblock %}

{% block content %}
<div class="d-flex">
    {% include "course/sidenav.html" %}
    <div class="main-container p-4">

        <div class="course-header" style="background-color: {{ course.color|default:'#4CAF50' }};"

            <b>{{ course.code }}</b> | {{ course.title }} | {{ course_form.name }}
        </div>

        <h1 class="mt-4">Your Peer Assessment Results</h1>

        <h2 class="mt-4">Overall Average Score</h2>
        <p><strong>{{ score }}/5</strong></p>

        <h2 class="mt-4">Likert Question Averages</h2>
        <ul>
            {% for question, avg_score in likert_averages.items %}
                <li><strong>{{ question }}</strong>: {{ avg_score }}</li>
            {% empty %}
                <li>No Likert responses yet.</li>
            {% endfor %}
        </ul>

        <div class="row">
            {% for question, avg svore in likert_averages.items %}
                <div class="col-md-4">
                    <p><strong>{{ question }}</strong></p>
                    <p>Average: {{ avg_score }}/5</p>
                </div>
                <div class="col-md-8"></div>
                    <canvas id="chart-{{ forloop.counter0 }}" height="120"></canvas>
                </div>
            {% empty %}
                <p>No Likert responses yet.</p>
            {% endfor %}
        </div>

        <h2 class="mt-4">Peer Feedback</h2>
        <div class="feedback-box">
            {% for comment in feedback %}
                <p>"{{ comment }}"</p>
            {% empty %}
                <p>No feedback available yet.</p>
            {% endfor %}
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const distributions = {{ likert_distributions_json|safe }};
  distributions.forEach((item, idx) => {
    const ctx = document.getElementById(`chart-${idx}`).getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['1', '2', '3', '4', '5'],
        datasets: [{
          label: 'Count',
          data: item.counts,
        }]
      },
      options: {
        indexAxis: 'y',               // horizontal bars
        scales: { 
          x: { beginAtZero: true } 
        },
        plugins: { 
          legend: { display: false } 
        }
      }
    });
  });
</script>

{% endblock %} 